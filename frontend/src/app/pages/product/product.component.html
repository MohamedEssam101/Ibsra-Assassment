<section>
  @if(product$ | async ; as product){

  <div class="flex flex-col lg:flex-row m-auto max-w-7xl">
    <!-- product carousel -->
    <div class="px-4 md:px-8 py-6 w-full lg:w-1/2">
      <p-galleria
        [value]="product.images"
        [numVisible]="Math.max(1, product.images.length - 1)"
        [circular]="true"
        [containerStyle]="{ 'max-width': '100%', width: '100%' }"
        [thumbnailsPosition]="'bottom'"
        [showItemNavigatorsOnHover]="true"
        [showIndicators]="false"
        [showThumbnails]="true"
      >
        <ng-template #item let-item>
          <div class="max-h-[300px] md:max-h-[400px] lg:max-h-[500px] flex">
            <img
              [src]="item"
              class="max-h-[250px] md:max-h-[350px] lg:max-h-[400px] w-auto object-contain mx-auto"
            />
          </div>
        </ng-template>

        <ng-template #thumbnail let-item>
          <div class="aspect-square overflow-hidden border rounded-lg">
            <img [src]="item" class="h-16 md:h-20 lg:h-30 object-cover" />
          </div>
        </ng-template>
      </p-galleria>
    </div>

    <!-- Enhanced product description -->
    <div class="flex flex-col px-4 md:px-8 py-4 w-full lg:w-1/2 lg:max-w-5/12">
      <!-- Product Title & Price -->
      <div class="mb-4 md:mb-6">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2 md:mb-3">
          {{ product.name }}
        </h1>
        <div class="flex flex-col sm:flex-row sm:items-center gap-2 md:gap-3">
          <span class="text-2xl md:text-3xl font-bold text-gray-900">{{
            product.price | currency
          }}</span>
          @if(!product.inStock) {
          <span
            class="bg-red-100 text-red-800 text-sm font-medium px-3 py-1 rounded-full w-fit"
            >Out of Stock</span
          >
          }
        </div>
      </div>

      <!-- Product Description -->
      @if(product.description) {
      <div class="mb-4 md:mb-6">
        <p class="text-gray-600 leading-relaxed text-base md:text-lg">
          {{ product.description }}
        </p>
      </div>
      }

      <!-- Color Selection -->
      <div class="mb-4 md:mb-6">
        <h3
          class="text-base md:text-lg font-semibold text-gray-900 mb-3 md:mb-4"
        >
          Available Colors
        </h3>
        <div class="flex gap-2 md:gap-3 flex-wrap">
          @for(color of product.color; track color) {
          <button
            (click)="selectColor(color)"
            [ngClass]="{
              'border-green-500 bg-green-50 text-gren-700 shadow-lg shadow-green-200 scale-105':
                selectedColor === color,
              'border-gray-300 text-gray-700 hover:border-gray-500 hover:bg-gray-50':
                selectedColor !== color
            }"
            class="px-3 md:px-4 py-2 border-2 rounded-lg text-xs md:text-sm font-medium transition-all duration-200 capitalize"
          >
            {{ color }}
            @if(selectedColor === color) {
            <i class="pi pi-check text-green-600 ml-1"></i>
            }
          </button>
          }
        </div>
      </div>

      <!-- Size Selection -->
      <div class="mb-4 md:mb-6">
        <h3
          class="text-base md:text-lg font-semibold text-gray-900 mb-3 md:mb-4"
        >
          Available Sizes
        </h3>
        <div class="flex gap-2 flex-wrap">
          @for(size of product.sizes; track size) {
          <button
            (click)="selectSize(size)"
            [ngClass]="{
              'border-gray-900 bg-gray-900 text-white shadow-lg shadow-gray-400 scale-105':
                selectedSize === size,
              'border-gray-300 text-gray-700 hover:border-gray-900 hover:bg-gray-900 hover:text-white':
                selectedSize !== size
            }"
            class="px-3 md:px-4 py-2 md:py-3 border-2 rounded-lg text-xs md:text-sm font-medium transition-all duration-200 min-w-[40px] md:min-w-[50px]"
          >
            {{ size }}
            @if(selectedSize === size) {
            <i class="pi pi-check text-white ml-1"></i>
            }
          </button>
          }
        </div>
      </div>

      <!-- Stock Status -->
      <div class="mb-6 md:mb-8">
        <div class="flex items-center gap-2">
          @if(product.inStock) {
          <div class="w-3 h-3 bg-green-500 rounded-full"></div>
          <span class="text-sm text-green-600 font-medium">In Stock</span>
          } @else {
          <div class="w-3 h-3 bg-red-500 rounded-full"></div>
          <span class="text-sm text-red-600 font-medium">Out of Stock</span>
          }
        </div>
      </div>

      <!-- Quantity & Action Buttons -->
      <div class="space-y-3 md:space-y-4">
        <!-- Quantity Selector -->
        <div>
          <h3 class="text-sm font-semibold text-gray-900 mb-2 md:mb-3">
            Quantity
          </h3>
          <div
            class="flex items-center border-2 border-gray-300 rounded-lg w-fit"
          >
            <button
              class="px-3 md:px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 transition-colors"
            >
              <i class="pi pi-minus text-sm"></i>
            </button>
            <span class="px-4 md:px-6 py-2 text-gray-900 font-medium">1</span>
            <button
              class="px-3 md:px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-50 transition-colors"
            >
              <i class="pi pi-plus text-sm"></i>
            </button>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-3 md:gap-4">
          <button
            [disabled]="!product.inStock"
            class="flex-1 bg-black text-white py-3 md:py-4 px-4 md:px-6 rounded-lg font-semibold hover:bg-gray-800 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 text-sm md:text-base"
          >
            Add to Cart
          </button>
          <button
            class="flex-1 px-4 md:p-4 py-3 md:py-4 border-2 border-gray-300 rounded-lg hover:border-gray-400 transition-colors duration-200 text-sm md:text-base"
          >
            <span class="sm:hidden">Wishlist</span>
            <span class="hidden sm:inline">Wishlist</span>
            <i class="pi pi-heart text-lg md:text-xl text-gray-600 ml-2"></i>
          </button>
        </div>

        <!-- Buy Now Button -->
        <button
          [disabled]="!product.inStock"
          class="w-full bg-blue-600 text-white py-3 md:py-4 px-4 md:px-6 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 text-sm md:text-base"
          (click)="addToCart(product._id)"
        >
          Buy Now
        </button>
      </div>
    </div>
  </div>
  }
</section>
